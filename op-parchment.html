<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>@parchment</title>
	<link rel="stylesheet" href="if.css">
</head>
<body>

<h1>@parchment</h1>
<p>Dannii Willis &lt;<a href="mailto:curiousdannii@gmail.com">curiousdannii@gmail.com</a>&gt;
<p>Permalink: <a href="http://curiousdannii.github.com/if/op-parchment.html">http://curiousdannii.github.com/if/op-parchment.html</a>
<p>Status: draft as of 1 November 2010.</p>

<h2>Introduction</h2>
<p><code>@parchment</code> is a new opcode for the Z-Machine version 1.2 and Glulx, which has a number of experimental functions for use with the Parchment web interpreter <a href="#parchment">[Parchment]</a>. It is used for testing functionality which is not yet stable enough to be formally standardised. Any use of <code>@parchment</code> is at your own risk!

<h2>Testing for support</h2>
<p>To test for support, please use @gestalt. For Glulx, check the <code>@gestalt</code> selector <code>$1110</code> <a href="#glulx">[Glulx]</a>. If the Z-Machine supports the new version 1.2 proposal, check selector <code>$20</code> <a href="#spec12">[Spec12]</a>. After checking if the opcode is supported, use <code>@gestalt</code> again to check if a particular function is supported, calling it with the function ID as the argument.

<h2>The @parchment opcode</h2>
<p>The <code>@parchment</code> opcode has the following specification:
<p><code>@parchment id arg -> (result);</code>

<p>This will perform function <code>id</code> with optional argument <code>arg</code>, possibly storing a result in <code>result</code>. Not all functions will specify a result; the rest will store <code>0</code>. For Glulx the opcode number is <code>$1110</code> <a href="#glulx">[Glulx]</a>. If the Z-Machine supports the new version 1.2 proposal, the opcode used is <code>EXT:31</code> <a href="#spec12">[Spec12]</a>.

<h2>Tests</h2>
<p>Tests are available for <code>@parchment</code>: <a href="tests/op-parchment.inf">source code</a>/<a href="tests/op-parchment.z5">compiled zcode</a>.

<h2>Functions</h2>
<table>
	<tr><th>Function title</th><th>ID</th><th>Description</td></tr>

	<tr><td>Raw eval()</td><td><code>0x01</code></td><td>Call with <code>arg=1</code> to switch to the raw eval() mode, where anything that is printed will be buffered to evaluate later. Then call with <code>arg=0</code> to <code>eval()</code> the current buffer. The <code>PARCHMENT_SECURITY_OVERRIDE</code> Javascript variable must be set to use this function.</td></tr>

</table>

<h2 id="references">References</h2>
<dl>
	<dt><a id="glulx">[Glulx]</a></dt>
	<dd><cite><a href="http://www.eblong.com/zarf/glulx/glulx-spec.html">Glulx - VM specification version 3.1.2.</a></cite> 2010. Andrew Plotkin.</dd>

	<dt><a id="parchment">[Parchment]</a></dt>
	<dd><cite><a href="http://code.google.com/p/parchment/">Parchment web interpreter.</a></cite></dd>

	<dt><a id="spec12">[Spec12]</a></dt>
	<dd><cite><a href="http://curiousdannii.github.com/if/zspec12.html">The Z-Machine Standard 1.2.</a></cite> 2010. Dannii Willis.</dd>
</dl>

</body>
</html>
